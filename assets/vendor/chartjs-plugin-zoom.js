/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import n from"hammerjs";import{each as t,callback as e,sign as o,valueOrDefault as a,getRelativePosition as i}from"/npm/chart.js@4.4.0/helpers/+esm";
/*!
* chartjs-plugin-zoom v2.0.1
* undefined
 * (c) 2016-2023 chartjs-plugin-zoom Contributors
 * Released under the MIT License
 */const r=n=>n&&n.enabled&&n.modifierKey,c=(n,t)=>n&&t[n+"Key"],s=(n,t)=>n&&!t[n+"Key"];function l(n,t,e){return void 0===n||("string"==typeof n?-1!==n.indexOf(t):"function"==typeof n&&-1!==n({chart:e}).indexOf(t))}function m(n,t){return"function"==typeof n&&(n=n({chart:t})),"string"==typeof n?{x:-1!==n.indexOf("x"),y:-1!==n.indexOf("y")}:{x:!1,y:!1}}function u(n,e,o){const{mode:a="xy",scaleMode:i,overScaleMode:r}=n||{},c=function({x:n,y:t},e){const o=e.scales,a=Object.keys(o);for(let e=0;e<a.length;e++){const i=o[a[e]];if(t>=i.top&&t<=i.bottom&&n>=i.left&&n<=i.right)return i}return null}(e,o),s=m(a,o),l=m(i,o);if(r){const n=m(r,o);for(const t of["x","y"])n[t]&&(l[t]=s[t],s[t]=!1)}if(c&&l[c.axis])return[c];const u=[];return t(o.scales,(function(n){s[n.axis]&&u.push(n)})),u}const d=new WeakMap;function f(n){let t=d.get(n);return t||(t={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{}},d.set(n,t)),t}function p(n,t,e){const o=n.max-n.min,a=o*(t-1),i=n.isHorizontal()?e.x:e.y,r=Math.max(0,Math.min(1,(n.getValueForPixel(i)-n.min)/o||0));return{min:a*r,max:a*(1-r)}}function h(n,t,e,o,i){let r=e[o];if("original"===r){const e=n.originalScaleLimits[t.id][o];r=a(e.options,e.scale)}return a(r,i)}function x(n,{min:t,max:e},o,a=!1){const i=f(n.chart),{id:r,axis:c,options:s}=n,l=o&&(o[r]||o[c])||{},{minRange:m=0}=l,u=h(i,n,l,"min",-1/0),d=h(i,n,l,"max",1/0),p=a?Math.max(e-t,m):n.max-n.min,x=(p-e+t)/2;return e+=x,(t-=x)<u?(t=u,e=Math.min(u+p,d)):e>d&&(e=d,t=Math.max(d-p,u)),s.min=t,s.max=e,i.updatedScaleLimits[n.id]={min:t,max:e},n.parse(t)!==n.min||n.parse(e)!==n.max}const g=n=>0===n||isNaN(n)?0:n<0?Math.min(Math.round(n),-1):Math.max(Math.round(n),1);const y={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function b(n,t,e,o=!1){const{min:a,max:i,options:r}=n,c=r.time&&r.time.round,s=y[c]||0,l=n.getValueForPixel(n.getPixelForValue(a+s)-t),m=n.getValueForPixel(n.getPixelForValue(i+s)-t),{min:u=-1/0,max:d=1/0}=o&&e&&e[n.axis]||{};return!!(isNaN(l)||isNaN(m)||l<u||m>d)||x(n,{min:l,max:m},e,o)}function w(n,t,e){return b(n,t,e,!0)}const v={category:function(n,t,e,o){const a=p(n,t,e);return n.min===n.max&&t<1&&function(n){const t=n.getLabels().length-1;n.min>0&&(n.min-=1),n.max<t&&(n.max+=1)}(n),x(n,{min:n.min+g(a.min),max:n.max-g(a.max)},o,!0)},default:function(n,t,e,o){const a=p(n,t,e);return x(n,{min:n.min+a.min,max:n.max-a.max},o,!0)}},z={default:function(n,t,e,o){x(n,function(n,t,e){const o=n.getValueForPixel(t),a=n.getValueForPixel(e);return{min:Math.min(o,a),max:Math.max(o,a)}}(n,t,e),o,!0)}},M={category:function(n,t,e){const o=n.getLabels().length-1;let{min:a,max:i}=n;const r=Math.max(i-a,1),c=Math.round(function(n){return n.isHorizontal()?n.width:n.height}(n)/Math.max(r,10)),s=Math.round(Math.abs(t/c));let l;return t<-c?(i=Math.min(i+s,o),a=1===r?i:i-r,l=i===o):t>c&&(a=Math.max(0,a-s),i=1===r?a:a+r,l=0===a),x(n,{min:a,max:i},e)||l},default:b,logarithmic:w,timeseries:w};function S(n,e){t(n,((t,o)=>{e[o]||delete n[o]}))}function P(n,e){const{scales:o}=n,{originalScaleLimits:a,updatedScaleLimits:i}=e;return t(o,(function(n){(function(n,t,e){const{id:o,options:{min:a,max:i}}=n;if(!t[o]||!e[o])return!0;const r=e[o];return r.min!==a||r.max!==i})(n,a,i)&&(a[n.id]={min:{scale:n.min,options:n.options.min},max:{scale:n.max,options:n.options.max}})})),S(a,o),S(i,o),a}function D(n,t,o,a){const i=v[n.type]||v.default;e(i,[n,t,o,a])}function k(n,t,o,a,i){const r=z[n.type]||z.default;e(r,[n,t,o,a,i])}function Z(n){const t=n.chartArea;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function O(n,o,a="none"){const{x:i=1,y:r=1,focalPoint:c=Z(n)}="number"==typeof o?{x:o,y:o}:o,s=f(n),{options:{limits:l,zoom:m}}=s;P(n,s);const d=1!==i,p=1!==r,h=u(m,c,n);t(h||n.scales,(function(n){n.isHorizontal()&&d?D(n,i,c,l):!n.isHorizontal()&&p&&D(n,r,c,l)})),n.update(a),e(m.onZoom,[{chart:n}])}function j(n,o,a,i="none"){const r=f(n),{options:{limits:c,zoom:s}}=r,{mode:m="xy"}=s;P(n,r);const u=l(m,"x",n),d=l(m,"y",n);t(n.scales,(function(n){n.isHorizontal()&&u?k(n,o.x,a.x,c):!n.isHorizontal()&&d&&k(n,o.y,a.y,c)})),n.update(i),e(s.onZoom,[{chart:n}])}function L(n,t,e,o="none"){P(n,f(n));x(n.scales[t],e,void 0,!0),n.update(o)}function R(n,o="default"){const a=f(n),i=P(n,a);t(n.scales,(function(n){const t=n.options;i[n.id]?(t.min=i[n.id].min.options,t.max=i[n.id].max.options):(delete t.min,delete t.max)})),n.update(o),e(a.options.zoom.onZoomComplete,[{chart:n}])}function C(n){const e=f(n);let o=1,i=1;return t(n.scales,(function(n){const t=function(n,t){const e=n.originalScaleLimits[t];if(!e)return;const{min:o,max:i}=e;return a(i.options,i.scale)-a(o.options,o.scale)}(e,n.id);if(t){const e=Math.round(t/(n.max-n.min)*100)/100;o=Math.min(o,e),i=Math.max(i,e)}})),o<1?o:i}function T(n,t,a,i){const{panDelta:r}=i,c=r[n.id]||0;o(c)===o(t)&&(t+=c);const s=M[n.type]||M.default;e(s,[n,t,a])?r[n.id]=0:r[n.id]=t}function E(n,o,a,i="none"){const{x:r=0,y:c=0}="number"==typeof o?{x:o,y:o}:o,s=f(n),{options:{pan:l,limits:m}}=s,{onPan:u}=l||{};P(n,s);const d=0!==r,p=0!==c;t(a||n.scales,(function(n){n.isHorizontal()&&d?T(n,r,m,s):!n.isHorizontal()&&p&&T(n,c,m,s)})),n.update(i),e(u,[{chart:n}])}function F(n){const t=f(n);P(n,t);const e={};for(const o of Object.keys(n.scales)){const{min:n,max:a}=t.originalScaleLimits[o]||{min:{},max:{}};e[o]={min:n.scale,max:a.scale}}return e}function H(n,t){const{handlers:e}=f(n),o=e[t];o&&o.target&&(o.target.removeEventListener(t,o),delete e[t])}function Y(n,t,e,o){const{handlers:a,options:i}=f(n),r=a[e];r&&r.target===t||(H(n,e),a[e]=t=>o(n,t,i),a[e].target=t,t.addEventListener(e,a[e]))}function V(n,t){const e=f(n);e.dragStart&&(e.dragging=!0,e.dragEnd=t,n.update("none"))}function K(n,t){const e=f(n);e.dragStart&&"Escape"===t.key&&(H(n,"keydown"),e.dragging=!1,e.dragStart=e.dragEnd=null,n.update("none"))}function N(n,t,o){const{onZoomStart:a,onZoomRejected:r}=o;if(a){const o=i(t,n);if(!1===e(a,[{chart:n,event:t,point:o}]))return e(r,[{chart:n,event:t}]),!1}}function X(n,t){const o=f(n),{pan:a,zoom:i={}}=o.options;if(0!==t.button||c(r(a),t)||s(r(i.drag),t))return e(i.onZoomRejected,[{chart:n,event:t}]);!1!==N(n,t,i)&&(o.dragStart=t,Y(n,n.canvas,"mousemove",V),Y(n,window.document,"keydown",K))}function W(n,t,e,o){const a=l(t,"x",n),r=l(t,"y",n);let{top:c,left:s,right:m,bottom:u,width:d,height:f}=n.chartArea;const p=i(e,n),h=i(o,n);a&&(s=Math.min(p.x,h.x),m=Math.max(p.x,h.x)),r&&(c=Math.min(p.y,h.y),u=Math.max(p.y,h.y));const x=m-s,g=u-c;return{left:s,top:c,right:m,bottom:u,width:x,height:g,zoomX:a&&x?1+(d-x)/d:1,zoomY:r&&g?1+(f-g)/f:1}}function B(n,t){const o=f(n);if(!o.dragStart)return;H(n,"mousemove");const{mode:a,onZoomComplete:i,drag:{threshold:r=0}}=o.options.zoom,c=W(n,a,o.dragStart,t),s=l(a,"x",n)?c.width:0,m=l(a,"y",n)?c.height:0,u=Math.sqrt(s*s+m*m);if(o.dragStart=o.dragEnd=null,u<=r)return o.dragging=!1,void n.update("none");j(n,{x:c.left,y:c.top},{x:c.right,y:c.bottom},"zoom"),setTimeout((()=>o.dragging=!1),500),e(i,[{chart:n}])}function q(n,t){const{handlers:{onZoomComplete:o},options:{zoom:a}}=f(n);if(!function(n,t,o){if(s(r(o.wheel),t))e(o.onZoomRejected,[{chart:n,event:t}]);else if(!1!==N(n,t,o)&&(t.cancelable&&t.preventDefault(),void 0!==t.deltaY))return!0}(n,t,a))return;const i=t.target.getBoundingClientRect(),c=1+(t.deltaY>=0?-a.wheel.speed:a.wheel.speed);O(n,{x:c,y:c,focalPoint:{x:t.clientX-i.left,y:t.clientY-i.top}}),o&&o()}function A(n,t,o,a){o&&(f(n).handlers[t]=function(n,t){let e;return function(){return clearTimeout(e),e=setTimeout(n,t),t}}((()=>e(o,[{chart:n}])),a))}function I(n,t){return function(o,a){const{pan:i,zoom:l={}}=t.options;if(!i||!i.enabled)return!1;const m=a&&a.srcEvent;return!m||(!(!t.panning&&"mouse"===a.pointerType&&(s(r(i),m)||c(r(l.drag),m)))||(e(i.onPanRejected,[{chart:n,event:a}]),!1))}}function U(n,t,e){if(t.scale){const{center:o,pointers:a}=e,i=1/t.scale*e.scale,r=e.target.getBoundingClientRect(),c=function(n,t){const e=Math.abs(n.clientX-t.clientX),o=Math.abs(n.clientY-t.clientY),a=e/o;let i,r;return a>.3&&a<1.7?i=r=!0:e>o?i=!0:r=!0,{x:i,y:r}}(a[0],a[1]),s=t.options.zoom.mode;O(n,{x:c.x&&l(s,"x",n)?i:1,y:c.y&&l(s,"y",n)?i:1,focalPoint:{x:o.x-r.left,y:o.y-r.top}}),t.scale=e.scale}}function G(n,t,e){const o=t.delta;o&&(t.panning=!0,E(n,{x:e.deltaX-o.x,y:e.deltaY-o.y},t.panScales),t.delta={x:e.deltaX,y:e.deltaY})}const J=new WeakMap;function Q(t,o){const a=f(t),i=t.canvas,{pan:r,zoom:c}=o,s=new n.Manager(i);c&&c.pinch.enabled&&(s.add(new n.Pinch),s.on("pinchstart",(()=>function(n,t){t.options.zoom.pinch.enabled&&(t.scale=1)}(0,a))),s.on("pinch",(n=>U(t,a,n))),s.on("pinchend",(n=>function(n,t,o){t.scale&&(U(n,t,o),t.scale=null,e(t.options.zoom.onZoomComplete,[{chart:n}]))}(t,a,n)))),r&&r.enabled&&(s.add(new n.Pan({threshold:r.threshold,enable:I(t,a)})),s.on("panstart",(n=>function(n,t,o){const{enabled:a,onPanStart:i,onPanRejected:r}=t.options.pan;if(!a)return;const c=o.target.getBoundingClientRect(),s={x:o.center.x-c.left,y:o.center.y-c.top};if(!1===e(i,[{chart:n,event:o,point:s}]))return e(r,[{chart:n,event:o}]);t.panScales=u(t.options.pan,s,n),t.delta={x:0,y:0},clearTimeout(t.panEndTimeout),G(n,t,o)}(t,a,n))),s.on("panmove",(n=>G(t,a,n))),s.on("panend",(()=>function(n,t){t.delta=null,t.panning&&(t.panEndTimeout=setTimeout((()=>t.panning=!1),500),e(t.options.pan.onPanComplete,[{chart:n}]))}(t,a)))),J.set(t,s)}function $(n,t,e){const o=e.zoom.drag,{dragStart:a,dragEnd:i}=f(n);if(o.drawTime!==t||!i)return;const{left:r,top:c,width:s,height:l}=W(n,e.zoom.mode,a,i),m=n.ctx;m.save(),m.beginPath(),m.fillStyle=o.backgroundColor||"rgba(225,225,225,0.3)",m.fillRect(r,c,s,l),o.borderWidth>0&&(m.lineWidth=o.borderWidth,m.strokeStyle=o.borderColor||"rgba(225,225,225)",m.strokeRect(r,c,s,l)),m.restore()}var _={id:"zoom",version:"2.0.1",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(t,e,o){f(t).options=o,Object.prototype.hasOwnProperty.call(o.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(o.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(o.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),n&&Q(t,o),t.pan=(n,e,o)=>E(t,n,e,o),t.zoom=(n,e)=>O(t,n,e),t.zoomRect=(n,e,o)=>j(t,n,e,o),t.zoomScale=(n,e,o)=>L(t,n,e,o),t.resetZoom=n=>R(t,n),t.getZoomLevel=()=>C(t),t.getInitialScaleBounds=()=>F(t),t.isZoomedOrPanned=()=>function(n){const t=F(n);for(const e of Object.keys(n.scales)){const{min:o,max:a}=t[e];if(void 0!==o&&n.scales[e].min!==o)return!0;if(void 0!==a&&n.scales[e].max!==a)return!0}return!1}(t)},beforeEvent(n){const t=f(n);if(t.panning||t.dragging)return!1},beforeUpdate:function(n,t,e){f(n).options=e,function(n,t){const e=n.canvas,{wheel:o,drag:a,onZoomComplete:i}=t.zoom;o.enabled?(Y(n,e,"wheel",q),A(n,"onZoomComplete",i,250)):H(n,"wheel"),a.enabled?(Y(n,e,"mousedown",X),Y(n,e.ownerDocument,"mouseup",B)):(H(n,"mousedown"),H(n,"mousemove"),H(n,"mouseup"),H(n,"keydown"))}(n,e)},beforeDatasetsDraw(n,t,e){$(n,"beforeDatasetsDraw",e)},afterDatasetsDraw(n,t,e){$(n,"afterDatasetsDraw",e)},beforeDraw(n,t,e){$(n,"beforeDraw",e)},afterDraw(n,t,e){$(n,"afterDraw",e)},stop:function(t){!function(n){H(n,"mousedown"),H(n,"mousemove"),H(n,"mouseup"),H(n,"wheel"),H(n,"click"),H(n,"keydown")}(t),n&&function(n){const t=J.get(n);t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy(),J.delete(n))}(t),function(n){d.delete(n)}(t)},panFunctions:M,zoomFunctions:v,zoomRectFunctions:z};export{_ as default,E as pan,R as resetZoom,O as zoom,j as zoomRect,L as zoomScale};
